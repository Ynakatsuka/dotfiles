---
name: my-skill-wip
alias: my-wip
description: >-
  Report current git branch progress with structured status.
  Shows recent commits, staged/unstaged changes, and related SDD documents.
  When conversation has progressed, generates a handoff context and saves it to `.tmp/wip/`.
  Use `/wip resume` to load the previous session's handoff context and resume work.
  Triggers on "/wip", "進捗確認", "ブランチの状況", "今どこまで進んだ？", "WIP report".
  Do NOT use for commit operations, PR creation, or branch management.
---

# WIP — Branch Progress Reporter

現在のブランチの開発進捗を構造化して報告する。

**重要: 高速化のため、サブエージェントは使わず Bash tool で直接データ収集する。**

## 引数判定（最初に実行）

$ARGUMENTS を確認する:

- **`resume` を含む場合** → 「再開モード」セクションへ進む
- **それ以外（引数なし含む）** → 「手順1」から通常フローを実行する

---

## 再開モード（`/wip resume`）

### 手順

1. 現在のブランチ名を取得する: `git branch --show-current`
2. `.tmp/wip/{branch_name}.md` を探す
3. ファイルが見つかった場合:
   - YAML frontmatter の `expires` を確認する
   - **有効期限内** → 「前回セッションの引き継ぎコンテキストを読み込みました。このコンテキストに基づいて作業を再開します。」と表示し、ファイル内容を出力する。その後、ユーザーの指示を待つ。
   - **期限切れ** → 「引き継ぎファイルが期限切れです（{expires}）。通常のWIPレポートを実行します。」と表示し、手順1へフォールバック
4. ファイルが見つからない場合:
   - 「引き継ぎファイルが見つかりません（.tmp/wip/{branch_name}.md）。通常のWIPレポートを実行します。」と表示し、手順1へフォールバック

---

## 通常フロー

### 手順1. Bash で一括データ収集

**Bash tool を1回呼び出し**、バンドルスクリプトを実行してデータを一括収集する:

```bash
bash <skill-path>/scripts/collect.sh
```

`<skill-path>` はこの SKILL.md が存在するディレクトリ。

各セクションは `=== SECTION_NAME ===` 区切りで出力される。期限切れ引き継ぎファイルの自動クリーンアップもスクリプト内で実行される。

### 手順2. Bash出力の解析

返されたデータを `=== SECTION_NAME ===` 区切りでパースし、以下を特定する:

**SDDがある場合**:
- requirements.md / tasks.md のタスクリストとコミット履歴・変更差分を照合
- 完了済み項目: コミットメッセージや変更ファイルから判定（tasks.md の `[x]` も参照）
- 未着手項目: まだ対応するコミット・変更がない項目
- 進行中項目: staged/unstagedの変更が対応している項目

**SDDがない場合**:
- 直近のコミットメッセージと未コミット変更から作業内容と次のアクションを推測

### 手順3. 会話コンテキストの確認

会話の履歴を振り返り、以下を整理する（セッション引き継ぎ用）:

- このセッションで行った実装・調査の要約
- 判明した技術的事実や制約
- 試したが失敗/却下したアプローチ
- 未解決の疑問

**注意**: 起動直後の `/wip` など会話がほぼない場合は、この手順をスキップする。

### 手順4. 進捗レポートの出力

以下のフォーマットで画面に出力する:

```
## 📊 WIP レポート — `{branch_name}`

**ベースブランチからのコミット数**: {N}件
**目的**: {1行要約}

### 進捗
- [x] {完了済み項目}
- [ ] → **次はこれ**: {未着手の最優先項目と理由}
- [ ] {残りの未着手項目}

### 変更サマリー
- ファイル変更: {N} files changed, {N} insertions(+), {N} deletions(-)
- Staged: {変更概要 or "なし"}
- Unstaged: {変更概要 or "なし"}
- Untracked: {ファイル一覧 or "なし"}
```

SDDがない場合はタスクリストの代わりに直近コミットから推定した作業内容を表示する。

### 手順5. セッション引き継ぎコンテキスト（会話が進んでいる場合のみ）

起動直後の `/wip` など会話がほぼない場合はこのセクションをスキップする。
会話がある程度進んでいる場合（調査・実装・議論などが行われた場合）は、以下のフォーマットで**画面出力とファイル保存の両方**を行う。

#### 5-a. 引き継ぎコンテキストの画面出力

以下のフォーマットで出力する:

````
---

## 次のセッション用コンテキスト

以下を新しいセッションの最初のメッセージとしてコピペしてください:
（`/wip resume` でも自動読み込みできます）

```
ブランチ `{branch_name}` で作業を継続します。

## 背景・目的
{SDDの要求または会話から抽出した目的の1-2行要約}

## 前回セッションの成果
{完了した実装・調査の箇条書き。具体的なファイルパスや関数名を含める}

## 判明した事実・制約
{調査で分かった技術的事実、注意すべき制約を箇条書き}

## 試したが失敗/却下したアプローチ
{再試行を防ぐための記録。なければ省略}

## 未解決の疑問
{答えが出ていない問題。なければ省略}

## タスクリスト
- [x] {完了済み}
- [ ] → **次はこれ**: {最優先の未着手項目}
- [ ] {残りの項目}

## 関連ファイル
- SDD: `docs/specs/{name}/`（あれば）
- 主な変更対象: {変更したファイルの一覧}
```
````

#### 5-b. 引き継ぎファイルの保存

Write tool で `.tmp/wip/{branch_name}.md` に保存する。フォーマット:

```markdown
---
branch: {branch_name}
created: {ISO 8601形式のJST日時、例: 2026-02-16T14:30:00+09:00}
expires: {作成日+3日のYYYY-MM-DD}
---

# 引き継ぎコンテキスト

ブランチ `{branch_name}` で作業を継続します。

## 背景・目的
{SDDの要求または会話から抽出した目的の1-2行要約}

## 前回セッションの成果
{完了した実装・調査の箇条書き。具体的なファイルパスや関数名を含める}

## 判明した事実・制約
{調査で分かった技術的事実、注意すべき制約を箇条書き}

## 試したが失敗/却下したアプローチ
{再試行を防ぐための記録。なければ省略}

## 未解決の疑問
{答えが出ていない問題。なければ省略}

## タスクリスト
- [x] {完了済み}
- [ ] → **次はこれ**: {最優先の未着手項目}
- [ ] {残りの項目}

## 関連ファイル
- SDD: `docs/specs/{name}/`（あれば）
- 主な変更対象: {変更したファイルの一覧}
```

**保存後のメッセージ**: 「引き継ぎコンテキストを `.tmp/wip/{branch_name}.md` に保存しました（有効期限: {expires}）。」

---

## 注意事項

- `.tmp/` は `.gitignore` に含めることを推奨（プロジェクトに追加されていなければユーザーに提案する）
- 引き継ぎファイルの有効期限はデフォルト3日。古いファイルはスクリプト実行時に自動削除される
- SDDの検出は、ブランチ名からプレフィックス（`sdd/`, `feat/`, `feature/`, `fix/`）を除去して `docs/specs/{name}/` または `.sdd/{name}.md` を探す
